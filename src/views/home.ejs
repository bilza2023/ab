<!DOCTYPE html>
<html>
<head>
  <title>Stock Control</title>
  <link rel="stylesheet" href="/css/main.css" />
</head>
<body>

  <%- include('./partials/nav') %>

<div class="container">

  <h1>Control Panel</h1>

  <% 
    const stations = {};
    mmas.forEach(code => {
      const station = code.split('_')[0];
      if (!stations[station]) stations[station] = [];
      stations[station].push(code);
    });
  %>

  <% Object.keys(stations).forEach(station => { %>
    
    <div class="section">
      <h2>Station: <%= station %></h2>

      <% stations[station].forEach(mma => { %>
        <div class="mma-card">
          <div class="mma-name"><%= mma %></div>
          <div class="action-row">

            <a class="button green" href="/deposit?to=<%= mma %>">Deposit</a>
            <a class="button red" href="/withdraw?from=<%= mma %>">Withdraw</a>

            <% if (lanes[mma]) { %>
              <% lanes[mma].forEach(target => { %>
                <a class="button blue" 
                   href="/dispatch?from=<%= mma %>&to=<%= target %>">
                   → <%= target %>
                </a>
              <% }) %>
            <% } %>

            <a class="button blue" href="/receive?to=<%= mma %>">
              ← Receive
            </a>

          </div>
        </div>
      <% }) %>

    </div>

  <% }) %>

</div>

</body>
</html>